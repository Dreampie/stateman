!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):"object"==typeof exports?exports.casca=e():t.casca=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){function r(t){return new i(t)}var i=n(1);r.location=n(2),r.util=n(3),t.exports=r},function(t,e,n){function r(t){t=t||{},i.call(this),delete t.state,this.options=t}var i=n(4),a=n(2),o=n(5),s=n(3);r.prototype=s.extend(s.ocreate(i.prototype),{constructor:r,nav:function(t,e){this.data=e,a.nav(t),this.data=null},start:function(t){var e=this;return this.preState=this,a.regist(function(t){e._afterPathChange(t)}),a.isStart||a.start(t||{}),this},_afterPathChange:function(t,e){var n=t.split("?"),r=n[1]&&n[1].split("&"),e={};if(r)for(var i=r.length;i--;){var a=r[i].split("=");e[a[0]]=a[1]}t=n[0],this.query=e;var o=this._findState(this,t);return o?(this.param=o.param,o.param=null,void this.go(o,this.data)):this.emit("cade: nofound",{path:t,query:this.query})},go:function(t){if(this.isGoing&&this.preState)return console.error("step on ["+this.preState.stateName+"] is not over");var e,n=this.preState,r={param:this.param,query:this.query,data:this.data||{}},e=this._findBase(n,t),i=this;i.isGoing=!0,this._leave(e,r,function(){i._enter(t,r,function(){i.isGoing=!1})}),this._checkQueryAndParam(e,r)},_findState:function(t,e){var n,r=t.regexp&&t.match(e),i=t._states;if(r)return t.param=r,t;for(var a in i)if(i.hasOwnProperty(a)&&(n=this._findState(i[a],e)))return n;return!1},_findBase:function(t,e){if(!t||!e||t==this||e==this)return this;for(var n=t.stateName.split("."),r=e.stateName.split("."),i=Math.min(n.length,r.length);i--;)if(r[i]===n[i])return this.state(n.slice(0,i+1));return this},_enter:function(t,e,n){n=n||noop;var r=this.preState||this;if(r==t)return n();for(var i=[];t!==r;)i.push(t),t=t.parent;this._enterOne(i,e,n)},_enterOne:function(t,e,n){var r=t.pop(),i=this;if(!r)return n();this.preState=r;var a=new o(e);a.oncompelete=function(){i._enterOne(t,e,n)},r.enter?(r.enter(a),a.asynced||a.done()):a.done()},_leave:function(t,e,n){return n=n||noop,t==this.preState?n():void this._leaveOne(t,e,n)},_leaveOne:function(t,e,n){if(!t||t===this.preState)return n();var r=new o(e),i=this;r.oncompelete=function(){i.preState.parent&&(i.preState=i.preState.parent),i._leaveOne(t,e,n)},this.preState.leave?(this.preState.leave(r),r.asynced||r.done()):r.done()},_checkQueryAndParam:function(t,e){for(var n=t;n!==this;)n.emit("casca:update",e),n=n.parent}}),t.exports=r},function(t,e,n){function r(){var t;return u.mode!==l?(t=location.href.match(d),t&&t[1]?t[1]:""):h.cleanPath(location.pathname+location.search||"").replace(s,"")}function i(){o(),setTimeout(i,60)}function a(t){for(var e=v.length;e--;)v[e](t)}function o(){var t=r();t!==u.currentPath&&(currentPath=t,a(currentPath))}var s,c=n(6),h=n(3),u=t.exports={},f=3,p=1,l=2,d=/#(.*)$/,v=[];u.isStart=!1,u.mode=p,u.suffix="",u.root="/",u.currentPath=void 0,u.start=function(t){if(t=t||{},u.isStart)return console.error("history is started");switch(u.isStart=!0,u.mode=t.html5&&c.history?l:p,c.hash||(u.mode=u.mode|l),u.root=t.root||"/",t.suffix&&(u.suffix=t.suffix),s=new RegExp("^"+u.suffix+u.root),u.mode){case p:c.on(window,"hashchange",o);break;case l:c.on(window,"popstate",o);break;case f:i()}o()},u.nav=function(t){u.currentPath!=t&&(u.currentPath=t,u.mode&p?location.hash="#"+t:history.pushState({},document.title,h.cleanPath(u.root+t)),a(t))},u.regist=function(t){t&&v.push(t)}},function(t){var e=t.exports={},n=[].slice,r={}.toString;e.extend=function(t,e,n){for(var r in e)(n||void 0===t[r])&&(t[r]=e[r]);return t},e.ocreate=Object.create||function(t){var e=function(){};return e.prototype=t,new e},e.slice=function(t,e){return n.call(t,e)},e.typeOf=function(t){return null==t?String(t):r.call(t).slice(8,-1).toLowerCase()},e.emitable=function(){var t={on:function(t,e){if("object"==typeof t)for(var n in t)this.on(n,t[n]);else{var r=this._handles||(this._handles={}),i=r[t]||(r[t]=[]);i.push(e)}return this},off:function(t,e){if(t&&(this._handles=[]),this._handles){var n,r=this._handles;if(n=r[t]){if(!e)return r[t]=[],this;for(var i=0,a=n.length;a>i;i++)if(e===n[i])return n.splice(i,1),this}return this}},emit:function(t){var n,r=e.slice(arguments,1),i=this._handles;if(!i||!(n=i[t]))return this;for(var a=0,o=n.length;o>a;a++)n[a].apply(this,r);return this}};return function(n){return n="function"==typeof n?n.prototype:n,e.extend(n,t)}}(),e.noop=function(){};var i=/\/{1,}/g,a=/\/$/;e.cleanPath=function(t){return t.replace(i,"/").replace(a,"")}},function(t,e,n){function r(t,e){if("regexp"===o.typeOf(t))return t;var n="^"+i("/"+t+"/?",e).replace(/([\/.])/g,"\\$1").replace(/(\*{2,})|(\*(?!\*))/g,function(t,e){return e?"(?:.*)":"(?:[^\\/]*)"})+"$";return new RegExp(n)}function i(t,e,n){return n=n||0,t.replace(/(\/)+/g,"/").replace(/(\/)?(?:(?:\((.+)\))|:([\w-]+)(?:\(([^:\(\)]+)\))?)/g,function(t,r,a,o,s){if(a){e&&e.push(n++);var c=i(a,e,n);return(r?"(?:/(":"(")+c+(r?"))":")")}return e&&e.push(o),(r?"(?:/":"")+"("+(s||"[\\w-]+")+")"+(r?")":"")})}function a(){this._states={},this.keys=[]}var o=n(3);o.extend(o.emitable(a),{state:function(t,e){var n,r,i,s=this._states,c=0;"string"==typeof t&&(t=t.split("."));var h=t.length,n=this;do{if(i=t[c],r=s[i],!r){if(!e)return;r=s[i]=new a,o.extend(r,{parent:n,stateName:t.join("."),currentName:i}),r.configUrl()}n=r,s=r._states}while(++c<h);return e?(r.config(e),this):n},config:function(t){var e=typeof t;"function"===e&&(t={enter:t});for(var n in t)switch(n){case"url":(this.url=t[n])&&this.configUrl();case"events":this.on(t[n]);default:this[n]=t[n]}},configUrl:function(){var t="",e=this,n=[];for(this.keys=[];e;){if(t=(e.url||e.currentName||"")+"/"+t,e===this&&(t.replace(/\:([-\w]+)/g,function(){n.push()}),this._watchedParam=n.concat(this.watched||[])),0===t.indexOf("^/")){t=t.slice(1);break}e=e.parent}this.path=o.cleanPath("/"+t);var i=this.path.split("?");this.path=i[0],i[1]&&(this._watchedQuery=i[1].split("&")),this.regexp=r(this.path,this.keys)},match:function(t){var e=this.regexp.exec(t),n=this.keys;if(e){for(var r={},i=0,a=n.length;a>i;i++)r[n[i]]=e[i+1];return r}return!1}}),t.exports=a},function(t,e,n){function r(t){i.extend(this,t||{})}var i=n(3),a=r.prototype;a.async=function(){this.asynced=!0},a.done=function(){this.oncompelete&&this.oncompelete()},t.exports=r},function(t){{var e=window,n=document;t.exports={hash:"onhashchange"in e&&(!n.documentMode||n.documentMode>7),history:e.history&&"onpopstate"in e,on:"attachEvent"in e?function(t,e,n){return t.attachEvent("on"+e,n)}:function(t,e,n){return t.addEventListener(e,n)}}}}])});