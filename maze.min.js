!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):"object"==typeof exports?exports.Maze=e():t.Maze=e()}(this,function(){return function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={exports:{},id:n,loaded:!1};return t[n].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){var n=i(1);n.Histery=i(2),n.util=i(3),n.State=i(4),n.Step=i(5),t.exports=n},function(t,e,i){function n(t){return this instanceof n==!1?new n(t):(t=t||{},r.call(this),t.history&&(this.history=t.history),void(this.curState=this))}var r=i(4),a=i(2),o=(i(6),i(5)),s=i(3);n.prototype=s.extend(s.ocreate(r.prototype),{constructor:n,nav:function(t,e){return this.history.nav(t,e),this},start:function(t){return this.history||(this.history=new a(t)),this.history.on("change",s.bind(this._afterPathChange,this)),this.history.isStart||this.history.start(),this},_afterPathChange:function(t){var e=t.split("?"),i=e[1]&&e[1].split("&"),n={};if(i)for(var r=i.length;r--;){var a=i[r].split("=");n[a[0]]=a[1]}this.query=n,t=e[0];var o=this._findState(this,t);if(!o){var s=this.state("$notfound");return s&&this.go(s,{query:n,param:{},silent:!0}),this.emit("state:404",{path:t,query:this.query})}this._go(o,{query:n,param:o.param||{}}),o.param=null},go:function(t,e){if(!e.silent){var i=t.getUrl(e);this.nav(i)}this._go(t,e)},_go:function(t,e){if("string"==typeof t&&(t=this.state(t)),!this.isGoing||!this.curState){var i=this.curState,n=this._findBase(i,t),r=this;this.isGoing=!0,this._leave(n,e,function(){r._enter(t,e,function(){r.isGoing=!1})}),this._checkQueryAndParam(n,e)}},_findState:function(t,e){var i,n,r=t._states;if(t.hasNext||(n=t.regexp&&t.match(e)),n)return t.param=n,t;for(var a in r)if(r.hasOwnProperty(a)&&(i=this._findState(r[a],e)))return i;return!1},_findBase:function(t,e){if(!t||!e||t==this||e==this)return this;for(var i,n=t,r=e;n&&r;){for(i=r;i;){if(n===i)return i;i=i.parent}n=n.parent}return this},_enter:function(t,e,i){i=i||s.noop;var n=this.curState||this;if(n==t)return i();for(var r=[];t!==n;)r.push(t),t=t.parent;this._enterOne(r,e,i)},_enterOne:function(t,e,i){var n=t.pop(),r=this;if(!n)return i();this.curState=n;var a=new o(e);a.oncompelete=function(){r._enterOne(t,e,i)},n.enter?(n.enter(a),a.asynced||a.done()):a.done()},_leave:function(t,e,i){return i=i||s.noop,t==this.curState?i():void this._leaveOne(t,e,i)},_leaveOne:function(t,e,i){if(!t||t===this.curState)return i();var n=new o(e),r=this;n.oncompelete=function(){r.curState.parent&&(r.curState=r.curState.parent),r._leaveOne(t,e,i)},this.curState.leave?(this.curState.leave(n),n.asynced||n.done()):n.done()},_checkQueryAndParam:function(t,e){for(var i=t;i!==this;)i.update&&i.update(e),i=i.parent}}),t.exports=n},function(t,e,i){function n(t){this.location=t.location||r.location,this.mode=t.mode||(t.html5&&r.history?h:s),this.html5=t.html5,r.hash||(this.mode=this.mode|h),this.prefix="#"+(t.prefix||""),this.rPrefix=new RegExp(this.prefix+"(.*)$"),this.interval=t.interval||1e3,this.root=t.root||"/",this.rRoot=new RegExp("^"+this.root),this._fixInitState(),null==t.autolink&&(t.autolink=!0),this._autolink(t.autolink),this.curPath=void 0}var r=i(6),a=i(3),o=3,s=1,h=2;a.extend(a.emitable(n),{start:function(){var t=this.getPath();if(this._checkPath=a.bind(this.checkPath,this),!this.isStart){switch(this.isStart=!0,this.mode===o&&this._fixHashProbelm(t),this.mode){case s:r.on(window,"hashchange",this._checkPath);break;case h:r.on(window,"popstate",this._checkPath);break;case o:this._checkLoop()}this.emit("change",t)}},stop:function(){r.off(window,"hashchange",this._checkPath),r.off(window,"popstate",this._checkPath),clearTimeout(this.tid),this.isStart=!1,this._checkPath=null},checkPath:function(){var t=this.getPath();t===this.curPath&&this.iframe&&(t=this.getPath(this.iframe.location)),t!==this.curPath&&(this.iframe&&this.nav(t),this.emit("change",this.curPath=a.cleanPath(t)))},getPath:function(t){var e,t=t||this.location;return this.mode!==h?(e=t.href.match(this.rPrefix),e&&e[1]?e[1]:""):a.cleanPath((t.pathname+t.search||"").replace(this.rRoot,"/"))},nav:function(t,e){e=e||{},t=a.cleanPath(t),this.curPath!=t&&(this.curPath=t,this.mode!==h?(this.location.hash="#"+t,this.iframe&&(this.iframe.location.hash="#"+t)):history.pushState({},e.title||"",a.cleanPath(this.root+t)),e.force&&this.emit("change",t))},_autolink:function(){var t=(this.prefix,this);r.on(document.body,"click",function(e){var i=e.target||e.srcElement;if("a"===i.tagName.toLowerCase()){var n=r.getHref(i).match(t.rPrefix),a=n&&n[1]?n[1]:"";if(a)return e.preventDefault&&e.preventDefault(),t.nav(a,{force:!0}),e.returnValue=!1}})},_checkLoop:function(){this.checkPath(),this.tid=setTimeout(a.bind(this._checkLoop,this),this.interval)},_fixInitState:function(){var t,e,i=a.cleanPath(this.location.pathname);this.mode!==h&&this.html5?(e=i.replace(this.rRoot,""),e&&this.location.replace(this.root+this.prefix+e)):this.mode===h&&(t=this.location.hash.replace(this.prefix,""),t&&history.replaceState({},document.title,a.cleanPath(this.root+t)))},_fixHashProbelm:function(t){var e=document.createElement("iframe"),i=document.body;e.src="javascript:0",e.style.display="none",e.tabIndex=-1,e.title="",this.iframe=i.insertBefore(e,i.firstChild).contentWindow,this.iframe.document.open().close(),this.iframe.location.hash="#"+t}}),t.exports=n},function(t){function e(t){var e=0,n=[],r=0,a="";t=i.cleanPath(t);var o=t.replace(/\:([\w-]+)(?:\(([^\/]+?)\))?|(?:\(([^\/]+)\))|(\*{2,})|(\*(?!\*))/g,function(i,o,s,h,c,u,f){return f>e&&(a+=t.slice(e,f)),e=f+i.length,o?(a+="("+o+")",n.push(o),"("+(s||"[\\w-]+")+")"):(a+="("+r+")",n.push(r++),h?"("+h+")":c?"(.*)":u?"([^\\/]*)":void 0)});return e!==t.length&&(a+=t.slice(e)),{regexp:new RegExp("^"+o+"/?$"),keys:n,matches:a||t}}var i=t.exports={},n=[].slice,r={}.toString;i.extend=function(t,e,i){for(var n in e)(i||void 0===t[n])&&(t[n]=e[n]);return t},i.ocreate=Object.create||function(t){var e=function(){};return e.prototype=t,new e},i.slice=function(t,e){return n.call(t,e)},i.typeOf=function(t){return null==t?String(t):r.call(t).slice(8,-1).toLowerCase()},i.emitable=function(){var t={on:function(t,e){if("object"==typeof t)for(var i in t)this.on(i,t[i]);else{var n=this._handles||(this._handles={}),r=n[t]||(n[t]=[]);r.push(e)}return this},off:function(t,e){if(t&&this._handles||(this._handles={}),this._handles){var i,n=this._handles;if(i=n[t]){if(!e)return n[t]=[],this;for(var r=0,a=i.length;a>r;r++)if(e===i[r])return i.splice(r,1),this}return this}},emit:function(t){var e,n=i.slice(arguments,1),r=this._handles;if(!r||!(e=r[t]))return this;for(var a=0,o=e.length;o>a;a++)e[a].apply(this,n);return this}};return function(e){return e="function"==typeof e?e.prototype:e,i.extend(e,t)}}(),i.noop=function(){},i.bind=function(t,e){return function(){return t.apply(e,arguments)}};var a=/\/+/g,o=/\/$/;i.cleanPath=function(t){return("/"+t).replace(a,"/").replace(o,"")||"/"},i.normalize=e},function(t,e,i){function n(t){this._states={},t&&this.config(t)}var r=i(3);r.extend(r.emitable(n),{state:function(t,e){var i,a,o,s=this._states,h=0;"string"==typeof t&&(t=t.split("."));var c=t.length,i=this;do{if(o=t[h],a=s[o],!a){if(!e)return;a=s[o]=new n,r.extend(a,{parent:i,stateName:t.join("."),currentName:o}),i.hasNext=!0,a.configUrl()}i=a,s=a._states}while(++h<c);return e?(a.config(e),this):i},config:function(t){if(t){t=this._getConfig(t);for(var e in t){var i=t[e];switch(e){case"url":"string"==typeof i&&(this.url=i,this.configUrl());break;case"events":this.on(i);break;default:this[e]=i}}}},_getConfig:function(t){return"function"==typeof t?{enter:t}:t},configUrl:function(){for(var t="",e=this,i=[];e;){if(t=("string"==typeof e.url?e.url:e.currentName||"")+"/"+t,e===this&&(this._watchedParam=i.concat(this.watched||[])),0===t.indexOf("^/")){t=t.slice(1);break}e=e.parent}this.path=r.cleanPath("/"+t);var n=this.path.split("?");this.path=n[0],n[1]&&(this._watchedQuery=n[1].split("&")),r.extend(this,r.normalize(this.path),!0)},getUrl:function(t){t=t||{};var e=t.param||{},i=t.query||{},n=this.matches.replace(/\(([\w-]+)\)/g,function(t,i){return e[i]||""})+"?";for(var a in i)i.hasOwnProperty(a)&&(n+=a+"="+i[a]+"&");return r.cleanPath(n.replace(/(?:\?|&)$/,""))},match:function(t){var e=this.regexp.exec(t),i=this.keys;if(e){for(var n={},r=0,a=i.length;a>r;r++)n[i[r]]=e[r+1];return n}return!1}}),t.exports=n},function(t,e,i){function n(t){r.extend(this,t||{})}var r=i(3),a=n.prototype;a.async=function(){this.asynced=!0},a.done=function(){this.oncompelete&&this.oncompelete()},t.exports=n},function(t){var e=window,i=document,n=t.exports={hash:"onhashchange"in e&&(!i.documentMode||i.documentMode>7),history:e.history&&"onpopstate"in e,location:e.location,getHref:function(t){return"href"in t?t.getAttribute("href",2):t.getAttribute("href")},on:"addEventListener"in e?function(t,e,i){return t.addEventListener(e,i)}:function(t,e,i){return t.attachEvent("on"+e,i)},off:"removeEventListener"in e?function(t,e,i){return t.removeEventListener(e,i)}:function(t,e,i){return t.detachEvent("on"+e,i)}};n.msie=parseInt((/msie (\d+)/.exec(navigator.userAgent.toLowerCase())||[])[1]),isNaN(n.msie)&&(n.msie=parseInt((/trident\/.*; rv:(\d+)/.exec(navigator.userAgent.toLowerCase())||[])[1]))}])});