!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):"object"==typeof exports?exports.Maze=e():t.Maze=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){var r=n(1);r.location=n(2),r.util=n(3),r.State=n(4),r.Step=n(5),t.exports=r},function(t,e,n){function r(t){return this instanceof r==!1?new r(t):(t=t||{},i.call(this),void(this.options=t))}var i=n(4),o=n(2),a=(n(6),n(5)),s=n(3);r.prototype=s.extend(s.ocreate(i.prototype),{constructor:r,nav:function(t,e){o.nav(t,e)},start:function(t){var e=this;return this.preState=this,o.regist(function(t){e._afterPathChange(t)}),o.isStart||o.start(t||{}),this},go:function(t,e){"string"==typeof t&&(t=this.state(t)),this.isGoing&&this.preState&&console.error("step on ["+this.preState.stateName+"] is not over");var n,r=this.preState,i={param:this.param,query:this.query};e&&s.extend(i.param,e,!0);var n=this._findBase(r,t),o=this;o.isGoing=!0,this._leave(n,i,function(){o._enter(t,i,function(){o.isGoing=!1})}),this._checkQueryAndParam(n,i)},_afterPathChange:function(t,e){var n=t.split("?"),r=n[1]&&n[1].split("&"),e={};if(r)for(var i=r.length;i--;){var o=r[i].split("=");e[o[0]]=o[1]}t=n[0],this.query=e;var a=this._findState(this,t);if(!a){var s=this.state("$notfound");return s&&this.go(s,{}),this.emit("state:404",{path:t,query:this.query})}this.param=a.param,a.param=null,this.go(a)},_findState:function(t,e){var n,r,i=t._states;if(t.hasNext||(r=t.regexp&&t.match(e)),r)return t.param=r,t;for(var o in i)if(i.hasOwnProperty(o)&&(n=this._findState(i[o],e)))return n;return!1},_findBase:function(t,e){if(!t||!e||t==this||e==this)return this;for(var n,r=t,i=e;r&&i;){for(n=i;n;){if(r===n)return n;n=n.parent}r=r.parent}return this},_enter:function(t,e,n){n=n||s.noop;var r=this.preState||this;if(r==t)return n();for(var i=[];t!==r;)i.push(t),t=t.parent;this._enterOne(i,e,n)},_enterOne:function(t,e,n){var r=t.pop(),i=this;if(!r)return n();this.preState=r;var o=new a(e);o.oncompelete=function(){i._enterOne(t,e,n)},r.enter?(r.enter(o),o.asynced||o.done()):o.done()},_leave:function(t,e,n){return n=n||s.noop,t==this.preState?n():void this._leaveOne(t,e,n)},_leaveOne:function(t,e,n){if(!t||t===this.preState)return n();var r=new a(e),i=this;r.oncompelete=function(){i.preState.parent&&(i.preState=i.preState.parent),i._leaveOne(t,e,n)},this.preState.leave?(this.preState.leave(r),r.asynced||r.done()):r.done()},_checkQueryAndParam:function(t,e){for(var n=t;n!==this;)n.update&&n.update(e),n=n.parent}}),t.exports=r},function(t,e,n){function r(){var t;return h.mode!==p?(t=location.href.match(l),t&&t[1]?t[1]:""):c.cleanPath((location.pathname+location.search||"").replace(h.rRoot,"/"))}function i(){a(),h.tid=setTimeout(i,800)}function o(t){for(var e=d.length;e--;)d[e](t)}function a(){var t=r();t!==h.currentPath&&(h.currentPath=c.cleanPath(t),o(h.currentPath))}var s=n(6),c=n(3),h=t.exports={},u=3,f=1,p=2,l=/#(.*)$/,d=[];h.isStart=!1,h.mode=f,h.suffix="",h.root="/",h.currentPath=void 0,h.rRoot=null,h.start=function(t){if(t=t||{},h.isStart)return console.error("history is started");switch(h.isStart=!0,h.mode=t.html5&&s.history?p:f,s.hash||(h.mode=h.mode|p),h.root=t.root||"/",t.suffix&&(h.suffix=t.suffix),h.rRoot=new RegExp("^"+h.suffix+h.root),h.mode){case f:s.on(window,"hashchange",a);break;case p:s.on(window,"popstate",a);break;case u:i()}a()},h.nav=function(t,e){e=e||{},"function"==typeof e&&(e={callback:e}),h.currentPath!=t&&(h.currentPath=t,h.mode&f?location.hash="#"+t:history.pushState({},document.title,c.cleanPath(h.root+t)),e.silent||(o(t),e.callback&&e.callback(t)))},h.stop=function(){s.off(window,"hashchange",a),s.off(window,"popstate",a),clearTimeout(h.tid),h.isStart=!1},h.regist=function(t){t&&d.push(t)}},function(t){var e=t.exports={},n=[].slice,r={}.toString;e.extend=function(t,e,n){for(var r in e)(n||void 0===t[r])&&(t[r]=e[r]);return t},e.ocreate=Object.create||function(t){var e=function(){};return e.prototype=t,new e},e.slice=function(t,e){return n.call(t,e)},e.typeOf=function(t){return null==t?String(t):r.call(t).slice(8,-1).toLowerCase()},e.emitable=function(){var t={on:function(t,e){if("object"==typeof t)for(var n in t)this.on(n,t[n]);else{var r=this._handles||(this._handles={}),i=r[t]||(r[t]=[]);i.push(e)}return this},off:function(t,e){if(t&&(this._handles=[]),this._handles){var n,r=this._handles;if(n=r[t]){if(!e)return r[t]=[],this;for(var i=0,o=n.length;o>i;i++)if(e===n[i])return n.splice(i,1),this}return this}},emit:function(t){var n,r=e.slice(arguments,1),i=this._handles;if(!i||!(n=i[t]))return this;for(var o=0,a=n.length;a>o;o++)n[o].apply(this,r);return this}};return function(n){return n="function"==typeof n?n.prototype:n,e.extend(n,t)}}(),e.noop=function(){};var i=/\/{1,}/g,o=/\/$/;e.cleanPath=function(t){return("/"+t).replace(i,"/").replace(o,"")}},function(t,e,n){function r(t,e){if("regexp"===a.typeOf(t))return t;var n="^"+i("/"+t+"/?",e).replace(/([\/.])/g,"\\$1").replace(/(\*{2,})|(\*(?!\*))/g,function(t,e){return e?"(?:.*)":"(?:[^\\/]*)"})+"$";return new RegExp(n)}function i(t,e,n){return n=n||0,t.replace(/(\/)+/g,"/").replace(/(\/)?(?:(?:\((.+)\))|:([\w-]+)(?:\(([^:\(\)]+)\))?|\(([^\(\)]+)\))/g,function(t,r,o,a,s){if(o){e&&e.push(n++);var c=i(o,e,n);return(r?"(?:/(":"(")+c+(r?"))":")")}return e&&e.push(a),(r?"(?:/":"")+"("+(s||"[\\w-]+")+")"+(r?")":"")})}function o(){this._states={},this.keys=[]}var a=n(3);a.extend(a.emitable(o),{state:function(t,e){var n,r,i,s=this._states,c=0;"string"==typeof t&&(t=t.split("."));var h=t.length,n=this;do{if(i=t[c],r=s[i],!r){if(!e)return;r=s[i]=new o,a.extend(r,{parent:n,stateName:t.join("."),currentName:i}),n.hasNext=!0,r.configUrl()}n=r,s=r._states}while(++c<h);return e?(r.config(e),this):n},config:function(t){if(t){t=this._getConfig(t);for(var e in t){var n=t[e];switch(e){case"url":"string"==typeof n&&(this.url=n,this.configUrl());break;case"events":this.on(n);break;default:this[e]=n}}}},_getConfig:function(t){return"function"==typeof t?{enter:t}:t},configUrl:function(){var t="",e=this,n=[];for(this.keys=[];e;){if(t=("string"==typeof e.url?e.url:e.currentName||"")+"/"+t,e===this&&(this._watchedParam=n.concat(this.watched||[])),0===t.indexOf("^/")){t=t.slice(1);break}e=e.parent}this.path=a.cleanPath("/"+t);var i=this.path.split("?");this.path=i[0],i[1]&&(this._watchedQuery=i[1].split("&")),this.regexp=r(this.path,this.keys)},match:function(t){var e=this.regexp.exec(t),n=this.keys;if(e){for(var r={},i=0,o=n.length;o>i;i++)r[n[i]]=e[i+1];return r}return!1}}),t.exports=o},function(t,e,n){function r(t){i.extend(this,t||{})}var i=n(3),o=r.prototype;o.async=function(){this.asynced=!0},o.done=function(){this.oncompelete&&this.oncompelete()},t.exports=r},function(t){{var e=window,n=document;t.exports={hash:"onhashchange"in e&&(!n.documentMode||n.documentMode>7),history:e.history&&"onpopstate"in e,on:"attachEvent"in e?function(t,e,n){return t.attachEvent("on"+e,n)}:function(t,e,n){return t.addEventListener(e,n)},off:"detachEvent"in e?function(t,e,n){return t.detachEvent("on"+e,n)}:function(t,e,n){return t.removeEventListener(e,n)}}}}])});