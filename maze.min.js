!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):"object"==typeof exports?exports.Maze=e():t.Maze=e()}(this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return t[i].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){var i=n(1);i.Histery=n(2),i.util=n(3),i.State=n(4),i.Step=n(5),t.exports=i},function(t,e,n){function i(t){return this instanceof i==!1?new i(t):(t=t||{},r.call(this),t.history&&(this.history=t.history),void(this.curState=this))}var r=n(4),o=n(2),a=(n(6),n(5)),s=n(3);i.prototype=s.extend(s.ocreate(r.prototype),{constructor:i,nav:function(t,e){return this.history.nav(t,e),this},start:function(t){return this.history||(this.history=new o(t)),this.history.on("change",s.bind(this._afterPathChange,this)),this.history.isStart||this.history.start(),this},_afterPathChange:function(t){var e=t.split("?"),n=e[1]&&e[1].split("&"),i={};if(n)for(var r=n.length;r--;){var o=n[r].split("=");i[o[0]]=o[1]}this.query=i,t=e[0];var a=this._findState(this,t);if(!a){var s=this.state("$notfound");return s&&this.go(s,{query:i}),this.emit("state:404",{path:t,query:this.query})}this._go(a,{query:i,param:a.param}),a.param=null},go:function(t,e){e.silent||(e=t.getUrl(e)),this._go(t,e)},_go:function(t,e){"string"==typeof t&&(t=this.state(t)),this.isGoing&&this.curState&&console.error("step on ["+this.curState.stateName+"] is not over");var n=this.curState,i=this._findBase(n,t),r=this;this.isGoing=!0,this._leave(i,e,function(){r._enter(t,e,function(){r.isGoing=!1})}),this._checkQueryAndParam(i,e)},_findState:function(t,e){var n,i,r=t._states;if(t.hasNext||(i=t.regexp&&t.match(e)),i)return t.param=i,t;for(var o in r)if(r.hasOwnProperty(o)&&(n=this._findState(r[o],e)))return n;return!1},_findBase:function(t,e){if(!t||!e||t==this||e==this)return this;for(var n,i=t,r=e;i&&r;){for(n=r;n;){if(i===n)return n;n=n.parent}i=i.parent}return this},_enter:function(t,e,n){n=n||s.noop;var i=this.curState||this;if(i==t)return n();for(var r=[];t!==i;)r.push(t),t=t.parent;this._enterOne(r,e,n)},_enterOne:function(t,e,n){var i=t.pop(),r=this;if(!i)return n();this.curState=i;var o=new a(e);o.oncompelete=function(){r._enterOne(t,e,n)},i.enter?(i.enter(o),o.asynced||o.done()):o.done()},_leave:function(t,e,n){return n=n||s.noop,t==this.curState?n():void this._leaveOne(t,e,n)},_leaveOne:function(t,e,n){if(!t||t===this.curState)return n();var i=new a(e),r=this;i.oncompelete=function(){r.curState.parent&&(r.curState=r.curState.parent),r._leaveOne(t,e,n)},this.curState.leave?(this.curState.leave(i),i.asynced||i.done()):i.done()},_checkQueryAndParam:function(t,e){for(var n=t;n!==this;)n.update&&n.update(e),n=n.parent}}),t.exports=i},function(t,e,n){function i(t){this.location=t.location||r.location,this.mode=t.html5&&r.history?h:s,r.hash||(this.mode=this.mode|h),this.prefix="#"+(t.prefix||""),this.rPrefix=new RegExp(this.prefix+"(.*)$"),this.root=t.root||"/",this.rRoot=new RegExp("^"+this.root),this.curPath=void 0}var r=n(6),o=n(3),a=3,s=1,h=2;o.extend(o.emitable(i),{start:function(){if(this._checkPath=o.bind(this.checkPath,this),!this.isStart){switch(this.isStart=!0,this.mode){case s:r.on(window,"hashchange",this._checkPath);break;case h:r.on(window,"popstate",this._checkPath);break;case a:this._checkLoop()}this.checkPath()}},stop:function(){r.off(window,"hashchange",this._checkPath),r.off(window,"popstate",this._checkPath),clearTimeout(this.tid),this.isStart=!1,this._checkPath=null},checkPath:function(){var t=this.getPath();t!==this.curPath&&this.emit("change",this.curPath=o.cleanPath(t))},getPath:function(){var t,e=this.location;return this.mode!==h?(t=e.href.match(this.rPrefix),t&&t[1]?t[1]:""):o.cleanPath((e.pathname+e.search||"").replace(this.rRoot,"/"))},nav:function(t,e){e=e||{},t=o.cleanPath(t),this.curPath!=t&&(this.curPath=t,this.mode!==h?this.location.hash="#"+t:history[e.replace?"replaceState":"pushState"]({},e.title||"",o.cleanPath(this.root+t)),e.force&&this.emit("change",t))},_checkLoop:function(){this.checkPath(),this.tid=setTimeout(o.bind(this._checkLoop,this),this.delay||66)}}),t.exports=i},function(t){function e(t){var e=0,i=[],r=0,o="";t=n.cleanPath(t);var a=t.replace(/\:([\w-]+)(?:\(([^\/]+?)\))?|(?:\(([^\/]+)\))|(\*{2,})|(\*(?!\*))/g,function(n,a,s,h,c,u,f){return f>e&&(o+=t.slice(e,f)),e=f+n.length,a?(o+="("+a+")",i.push(a),"("+(s||"[\\w-]+")+")"):(o+="("+r+")",i.push(r++),h?"("+h+")":c?"(.*)":u?"([^\\/]*)":void 0)});return e!==t.length&&(o+=t.slice(e)),{regexp:new RegExp("^"+a+"/?$"),keys:i,matches:o||t}}var n=t.exports={},i=[].slice,r={}.toString;n.extend=function(t,e,n){for(var i in e)(n||void 0===t[i])&&(t[i]=e[i]);return t},n.ocreate=Object.create||function(t){var e=function(){};return e.prototype=t,new e},n.slice=function(t,e){return i.call(t,e)},n.typeOf=function(t){return null==t?String(t):r.call(t).slice(8,-1).toLowerCase()},n.emitable=function(){var t={on:function(t,e){if("object"==typeof t)for(var n in t)this.on(n,t[n]);else{var i=this._handles||(this._handles={}),r=i[t]||(i[t]=[]);r.push(e)}return this},off:function(t,e){if(t&&this._handles||(this._handles={}),this._handles){var n,i=this._handles;if(n=i[t]){if(!e)return i[t]=[],this;for(var r=0,o=n.length;o>r;r++)if(e===n[r])return n.splice(r,1),this}return this}},emit:function(t){var e,i=n.slice(arguments,1),r=this._handles;if(!r||!(e=r[t]))return this;for(var o=0,a=e.length;a>o;o++)e[o].apply(this,i);return this}};return function(e){return e="function"==typeof e?e.prototype:e,n.extend(e,t)}}(),n.noop=function(){},n.bind=function(t,e){return function(){return t.apply(e,arguments)}};var o=/\/+/g,a=/\/$/;n.cleanPath=function(t){return("/"+t).replace(o,"/").replace(a,"")},n.normalize=e},function(t,e,n){function i(t){this._states={},t&&this.config(t)}var r=n(3);r.extend(r.emitable(i),{state:function(t,e){var n,o,a,s=this._states,h=0;"string"==typeof t&&(t=t.split("."));var c=t.length,n=this;do{if(a=t[h],o=s[a],!o){if(!e)return;o=s[a]=new i,r.extend(o,{parent:n,stateName:t.join("."),currentName:a}),n.hasNext=!0,o.configUrl()}n=o,s=o._states}while(++h<c);return e?(o.config(e),this):n},config:function(t){if(t){t=this._getConfig(t);for(var e in t){var n=t[e];switch(e){case"url":"string"==typeof n&&(this.url=n,this.configUrl());break;case"events":this.on(n);break;default:this[e]=n}}}},_getConfig:function(t){return"function"==typeof t?{enter:t}:t},configUrl:function(){for(var t="",e=this,n=[];e;){if(t=("string"==typeof e.url?e.url:e.currentName||"")+"/"+t,e===this&&(this._watchedParam=n.concat(this.watched||[])),0===t.indexOf("^/")){t=t.slice(1);break}e=e.parent}this.path=r.cleanPath("/"+t);var i=this.path.split("?");this.path=i[0],i[1]&&(this._watchedQuery=i[1].split("&")),r.extend(this,r.normalize(this.path),!0)},getUrl:function(t){t=t||{};var e=t.param||{},n=t.query||{},i=this.matches.replace(/\(([\w-]+)\)/g,function(t,n){return e[n]||""})+"?";for(var o in n)n.hasOwnProperty(o)&&(i+=o+"="+n[o]+"&");return r.cleanPath(i.replace(/(?:\?|&)$/,""))},match:function(t){var e=this.regexp.exec(t),n=this.keys;if(e){for(var i={},r=0,o=n.length;o>r;r++)i[n[r]]=e[r+1];return i}return!1}}),t.exports=i},function(t,e,n){function i(t){r.extend(this,t||{})}var r=n(3),o=i.prototype;o.async=function(){this.asynced=!0},o.done=function(){this.oncompelete&&this.oncompelete()},t.exports=i},function(t){{var e=window,n=document;t.exports={hash:"onhashchange"in e&&(!n.documentMode||n.documentMode>7),history:e.history&&"onpopstate"in e,location:e.location,on:"attachEvent"in e?function(t,e,n){return t.attachEvent("on"+e,n)}:function(t,e,n){return t.addEventListener(e,n)},off:"detachEvent"in e?function(t,e,n){return t.detachEvent("on"+e,n)}:function(t,e,n){return t.removeEventListener(e,n)}}}}])});